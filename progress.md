# WaitWiki 开发进度

## 当前版本
V1.0.0

## 最新更新 (2025-01-23)

### API调用频率优化
- **定时更新频率降低**：从30秒间隔改为3分钟间隔，大幅减少API调用频率
- **批量更新频率降低**：从10次点击改为15次点击触发，减少更新频率
- **API调用间隔控制**：所有API调用间隔2秒，避免并发请求导致API限制
- **更新数量减少**：单次更新数量减少，Wikipedia从3条改为2条，数据真相从2条改为1条
- **防频繁更新机制**：定时更新至少间隔2分钟，批量更新至少间隔60秒
- **缓存阈值调整**：缓存低于50时开始定时更新（原30），减少不必要的API调用

### 缓存更新机制优化
- **点击触发更新**：每次点击都会触发缓存更新，不再等待10次点击
- **缓存未满时批量更新**：缓存未满时，每10次点击也会触发批量更新
- **定时更新频率提升**：从60秒间隔改为30秒间隔，更频繁地更新缓存
- **更新阈值优化**：缓存低于30时开始定时更新（原50），提高响应速度
- **更新数量调整**：减少单次更新数量，避免API压力过大

### 智能后台更新机制
- **定时更新机制**：插件刷新后立即启动后台定时更新，每1分钟检查缓存状态
- **缓存状态管理**：缓存低于50时自动更新，高于250时停止更新，优化API使用频率
- **批量更新优化**：缓存满后按点击次数触发批量更新（每10次点击更新10-15条内容）
- **资源清理**：页面卸载时自动清理定时器和保存缓存，防止内存泄漏
- **更新策略**：优先更新Wikipedia和数据真相，确保内容丰富度和用户偏好

### Wikipedia和数据真相优先策略
- **内容选择优先级**：70%概率选择Wikipedia和数据真相，30%概率选择其他类型
- **Wikipedia优先**：在优先类型中，Wikipedia占60%，数据真相占40%
- **目标数量增加**：Wikipedia目标60条，数据真相目标40条，其他类型20条
- **批量更新优化**：优先更新Wikipedia和数据真相，确保内容丰富度
- **智能选择算法**：改进内容选择逻辑，确保Wikipedia和数据真相更频繁出现

### 本地内容优先策略
- **本地内容优先**：修改fetchKnowledgeCard方法，优先使用本地内容，减少API依赖
- **本地内容扩展**：大幅增加本地名言内容，从8条扩展到30条
- **内容多样性提升**：getLocalContent方法返回所有本地卡片，增加内容选择
- **API调用优化**：减少API调用频率，增加调用间隔，降低失败率
- **缓存策略改进**：强制预加载优先使用本地内容，API作为补充

### API调用逻辑修复
- **API调用逻辑修复**：修复fetchKnowledgeCard方法中的缓存优先逻辑，确保API能正常获取新内容
- **预加载方法优化**：强制预加载、批量更新、智能预加载都改为调用fetchNewCardFromAPI
- **缓存更新机制**：确保每次API调用都能正确更新缓存，而不是直接返回缓存内容
- **内容获取流程优化**：API失败时正确回退到本地内容，确保内容连续性

### 内容重复问题深度修复
- **缓存大小增加**：从200张增加到300张，提供更多内容选择
- **智能内容选择算法**：改进内容选择逻辑，优先选择不同类型的内容
- **防重复机制增强**：最近显示记录从20张增加到50张
- **内容相似度检测增强**：相似度记录从30条增加到50条
- **动态过滤条件**：当过滤后卡片太少时自动放宽条件
- **加权选择机制**：给不同类型的内容分配权重，确保内容多样性

### CSV文件访问修复
- **web_accessible_resources修复**：添加datafacts.csv到可访问资源列表
- **CSV文件路径问题解决**：修复Chrome扩展无法访问根目录CSV文件的问题
- **数据真相功能恢复**：确保300条Factfulness数据可以正常读取和显示

### 缓存和内容轮换优化
- **缓存大小增加**：从100张增加到200张，减少内容重复
- **预加载触发优化**：缓存不足50张时开始预加载（原30张）
- **批量更新频率提升**：每5次点击触发批量更新（原10次）
- **Wikipedia目标增加**：目标80条Wikipedia内容（原60条）
- **其他类型目标增加**：每种类型目标15条（原8条）
- **强制预加载机制**：初始化时强制预加载更多内容
- **CSV文件路径修复**：修复datafacts.csv文件路径问题

### 数据真相扩展至300条
- **数据量大幅扩展**：从160条扩展到300条，数据内容丰富度显著提升
- **数据分布优化**：全球数据61%，区域数据18%，国家数据21%
- **内容分类完善**：社会发展20%，技术发展20%，人口变化19%，健康发展19%，环境变化8%，经济发展6%，教育进步5%，贫困改善2%
- **地理覆盖全面**：涵盖全球、6大洲、60多个国家和地区的数据
- **时间跨度广泛**：从1800年到2020年的长期发展趋势数据
- **数据质量保证**：所有数据均基于Gapminder等权威机构，确保准确性和可信度

### 批量更新和Wikipedia优先策略
- **批量更新机制**：每10次点击自动批量更新10条内容，避免频繁API调用
- **Wikipedia优先策略**：目标缓存60条Wikipedia内容，其他类型每种8条
- **智能缓存管理**：缓存大小100张，优先保证Wikipedia内容丰富度
- **防重复更新**：30秒内不重复批量更新，避免过度请求

### 技术优化
- **点击计数器**：记录用户点击次数，触发批量更新
- **类型统计**：实时统计各类型缓存数量，智能补充
- **请求间隔控制**：Wikipedia请求间隔500ms，其他类型300ms
- **预加载优化**：优先预加载Wikipedia，确保内容丰富度

### 用户体验提升
- **内容丰富度提升**：Wikipedia内容占比60%，提供更丰富的知识
- **响应速度优化**：减少单次API调用，提高整体响应速度
- **网络友好**：批量更新减少网络请求频率，更稳定
- **智能补充**：自动检测缓存不足，智能补充内容

### 数据真相功能
- **数据来源**：整合多个权威数据源，确保信息准确性
- **数据分布优化**：降低国家相关数据比例，增加全球性和区域性数据
- **数据来源多样化**：Gapminder数据30%，联合国等权威机构50%，其他国际机构18%
- **用户反馈**：收集用户反馈，持续优化数据质量

## 历史版本

### V1.0.0 - API调用频率优化 (2025-01-23)
- **定时更新频率降低**：从30秒间隔改为3分钟间隔，大幅减少API调用频率
- **批量更新频率降低**：从10次点击改为15次点击触发，减少更新频率
- **API调用间隔控制**：所有API调用间隔2秒，避免并发请求导致API限制
- **更新数量减少**：单次更新数量减少，Wikipedia从3条改为2条，数据真相从2条改为1条
- **防频繁更新机制**：定时更新至少间隔2分钟，批量更新至少间隔60秒
- **缓存阈值调整**：缓存低于50时开始定时更新（原30），减少不必要的API调用

### V1.4.3 - 缓存更新机制优化 (2025-01-23)
- **点击触发更新**：每次点击都会触发缓存更新，不再等待10次点击
- **缓存未满时批量更新**：缓存未满时，每10次点击也会触发批量更新
- **定时更新频率提升**：从60秒间隔改为30秒间隔，更频繁地更新缓存
- **更新阈值优化**：缓存低于30时开始定时更新（原50），提高响应速度
- **更新数量调整**：减少单次更新数量，避免API压力过大
- **用户体验改善**：确保新开网页时也能持续更新缓存，提高内容新鲜度

### V1.4.2 - 智能后台更新机制 (2025-01-23)
- **定时更新机制**：插件刷新后立即启动后台定时更新，每1分钟检查缓存状态
- **缓存状态管理**：缓存低于50时自动更新，高于250时停止更新，优化API使用频率
- **批量更新优化**：缓存满后按点击次数触发批量更新（每10次点击更新10-15条内容）
- **资源清理**：页面卸载时自动清理定时器和保存缓存，防止内存泄漏
- **更新策略**：优先更新Wikipedia和数据真相，确保内容丰富度和用户偏好
- **API使用优化**：减少不必要的API调用，提高响应速度和稳定性

### V1.4.1 - Wikipedia和数据真相优先策略 (2025-01-23)
- **内容选择优先级**：70%概率选择Wikipedia和数据真相，30%概率选择其他类型
- **Wikipedia优先**：在优先类型中，Wikipedia占60%，数据真相占40%
- **目标数量增加**：Wikipedia目标60条，数据真相目标40条，其他类型20条
- **批量更新优化**：优先更新Wikipedia和数据真相，确保内容丰富度
- **智能选择算法**：改进内容选择逻辑，确保Wikipedia和数据真相更频繁出现

### V1.4.0 - 本地内容优先策略 (2025-01-23)
- **本地内容优先**：修改fetchKnowledgeCard方法，优先使用本地内容，减少API依赖
- **本地内容扩展**：大幅增加本地名言内容，从8条扩展到30条
- **内容多样性提升**：getLocalContent方法返回所有本地卡片，增加内容选择
- **API调用优化**：减少API调用频率，增加调用间隔，降低失败率
- **缓存策略改进**：强制预加载优先使用本地内容，API作为补充
- **目标数量增加**：其他类型目标从10条增加到20条，提供更多内容选择

### V1.3.9 - API调用逻辑修复 (2025-01-23)
- **API调用逻辑修复**：修复fetchKnowledgeCard方法中的缓存优先逻辑，确保API能正常获取新内容
- **预加载方法优化**：强制预加载、批量更新、智能预加载都改为调用fetchNewCardFromAPI
- **缓存更新机制**：确保每次API调用都能正确更新缓存，而不是直接返回缓存内容
- **内容获取流程优化**：API失败时正确回退到本地内容，确保内容连续性
- **调试日志增强**：添加详细的API调用日志，便于问题诊断

### V1.3.8 - 内容重复问题深度修复 (2025-01-23)
- **缓存大小增加**：从200张增加到300张，提供更多内容选择
- **智能内容选择算法**：改进内容选择逻辑，优先选择不同类型的内容
- **防重复机制增强**：最近显示记录从20张增加到50张
- **内容相似度检测增强**：相似度记录从30条增加到50条
- **动态过滤条件**：当过滤后卡片太少时自动放宽条件
- **加权选择机制**：给不同类型的内容分配权重，确保内容多样性
- **调试日志增强**：添加详细的选择过程日志，便于问题诊断

### V1.3.7 - CSV文件访问修复 (2025-01-23)
- **web_accessible_resources修复**：添加datafacts.csv到可访问资源列表
- **CSV文件路径问题解决**：修复Chrome扩展无法访问根目录CSV文件的问题
- **数据真相功能恢复**：确保300条Factfulness数据可以正常读取和显示
- **错误处理优化**：改进CSV文件读取的错误处理机制

### V1.3.6 - 缓存和内容轮换优化 (2025-01-23)
- **缓存大小增加**：从100张增加到200张，减少内容重复
- **预加载触发优化**：缓存不足50张时开始预加载（原30张）
- **批量更新频率提升**：每5次点击触发批量更新（原10次）
- **Wikipedia目标增加**：目标80条Wikipedia内容（原60条）
- **其他类型目标增加**：每种类型目标15条（原8条）
- **强制预加载机制**：初始化时强制预加载更多内容
- **CSV文件路径修复**：修复datafacts.csv文件路径问题
- **内容轮换改进**：优化防重复算法，确保内容多样性

### V1.3.5 - 数据真相扩展至300条 (2025-01-23)
- **数据量大幅扩展**：从160条扩展到300条，数据内容丰富度显著提升
- **数据分布优化**：全球数据61%，区域数据18%，国家数据21%
- **内容分类完善**：社会发展20%，技术发展20%，人口变化19%，健康发展19%，环境变化8%，经济发展6%，教育进步5%，贫困改善2%
- **地理覆盖全面**：涵盖全球、6大洲、60多个国家和地区的数据
- **时间跨度广泛**：从1800年到2020年的长期发展趋势数据
- **数据质量保证**：所有数据均基于Gapminder等权威机构，确保准确性和可信度
- **分批添加策略**：采用50条一批的分批添加方式，确保数据质量和多样性

### V1.3.4 - 数据分布优化 (2025-01-23)
- **数据分布优化**：降低国家相关数据比例，从80%降低到30%
- **全球性数据增加**：全球性数据占比从20%提升到70%
- **区域性数据增加**：新增区域性数据，占比30%
- **权威机构数据增加**：联合国等权威机构数据占比50%，其他国际机构18%
- **数据多样性提升**：160条精选数据，涵盖8个领域，6个地理区域
- **数据质量保证**：所有数据均来自权威机构，确保准确性和可信度

### V1.3.3 - 数据真相功能 (2025-01-23)
- **Factfulness理念**：基于Hans Rosling的Factfulness理念，展示与直觉相反的真实数据
- **全球发展数据**：涵盖贫困、健康、教育、技术、环境等8个关键领域的全球发展趋势
- **权威数据源**：基于Gapminder基金会、世界银行、联合国、WHO、国际电信联盟等权威机构的最新数据
- **认知纠偏**：通过数据展示世界如何变得更好，纠正常见的悲观认知偏差
- **本地数据库**：160条高质量数据真相内容，涵盖全球性、区域性和权威机构数据
- **数据分布优化**：降低国家相关数据比例，增加全球性和区域性数据，提高数据多样性
- **数据来源多样化**：Gapminder数据30%，联合国等权威机构50%，其他国际机构18%

### V1.3.2 - 批量更新和Wikipedia优先策略 (2025-01-23)
- **批量更新机制**：每10次点击自动批量更新10条内容，避免频繁API调用
- **Wikipedia优先策略**：目标缓存60条Wikipedia内容，其他类型每种8条
- **智能缓存管理**：缓存大小100张，优先保证Wikipedia内容丰富度
- **防重复更新**：30秒内不重复批量更新，避免过度请求

### V1.3.1 - 缓存优化和内容丰富化 (2025-01-23)
- 本地备用内容库：添加48条高质量本地内容，减少API依赖
- 智能缓存策略：缓存大小从100增加到200张，预加载数量从3增加到5张
- 内容相似度去重：新增内容关键词去重机制，防止相似内容重复显示
- API失败容错：API失败时自动切换到本地内容，确保内容连续性

### V1.3.0 - 智能推荐系统 (2025-01-23)
- 用户偏好学习：基于用户交互自动学习内容类型偏好
- 智能内容推荐：70%概率推荐用户偏好类型，30%概率保持多样性
- 内容质量评估：自动过滤低质量内容，提升用户体验
- 性能监控统计：实时监控API调用性能，优化响应时间

### V1.2.1 - 错误修复 (2025-01-23)
- 修复重复率过高问题：改进防重复算法，使用Set记录最近20张卡片
- 修复扩展上下文失效错误：在saveGlobalCache中检查chrome.runtime.id
- 修复API网络错误：为所有API调用添加5秒超时处理
- 修复面板分类显示：移除所有内容类型标签中的emoji

### V1.2 - 多API集成 (2025-01-23)
- 新增4个API：生活建议、猫咪趣闻、知识问答、鸡尾酒谱
- 添加内容类型控制面板，用户可自由开关各API
- 增强安全性：修复XSS漏洞，使用安全的DOM操作
- 改进内容轮换算法，避免连续显示相同卡片

### V1.1 - 基础功能完善 (2025-01-22)
- 实现维基百科、名言、趣闻三种内容类型
- 添加缓存机制和智能预加载
- 支持深色模式和响应式设计
- 完善错误处理和重试机制

### V1.0 - 初始版本 (2025-01-21)
- 基础卡片显示功能
- 维基百科API集成
- 简单的设置面板

## V1.4 计划功能
- 添加内容分享功能
- 支持更多语言
- 离线内容缓存
- 用户反馈系统
- 内容收藏功能